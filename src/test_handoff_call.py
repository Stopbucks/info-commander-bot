# ---------------------------------------------------------
# æœ¬ç¨‹å¼ç¢¼ï¼šsrc/test_handoff_call.py v1.5 (è³‡å®‰èˆ‡èªæ³•ä¿®æ­£ç‰ˆ)
# ä»»å‹™ï¼šåŸ·è¡Œç«¯é»ä¹‹é€šè¨Šå”è­°ç›¸å®¹æ€§é©—è­‰èˆ‡æ¡æ‰‹æ¸¬è©¦ã€‚
# ---------------------------------------------------------
import os
import requests
from dotenv import load_dotenv

# ä¸€è¡Œè¨»è§£ï¼šå•Ÿå‹•ç’°å¢ƒé…ç½®è¼‰å…¥æ©Ÿåˆ¶ã€‚
load_dotenv()

def run_precision_verification():
    # ä¸€è¡Œè¨»è§£ï¼šè®€å–æ˜ å°„å¾Œçš„ç’°å¢ƒè®Šæ•¸ã€‚
    target_endpoint = os.environ.get("TARGET_A")
    auth_token = os.environ.get("TOKEN_A")
    
    if not target_endpoint or not auth_token:
        print("âŒ [ä¸­æ­¢] ç’°å¢ƒè®Šæ•¸é…ç½®ä¸å…¨ï¼Œç„¡æ³•ç™¼å‹•ã€‚")
        return

    # ä¸€è¡Œè¨»è§£ï¼šå°é½Šæ¥æ”¶ç«¯(Render)æ‰€éœ€ä¹‹è‡ªå®šç¾©æ¨™é ­çµæ§‹ã€‚
    secure_headers = {
        "X-Cron-Secret": auth_token,
        "Content-Type": "application/json"
    }

    #---å‰é¢è®Šæ•¸å®£å‘Šç›¸åŒ---#
    # -----(å®šä½ç·š)ä»¥ä¸‹ä¿®æ”¹èªæ³•ç¸®æ’èˆ‡è¼¸å‡ºé‚è¼¯----
    print(f"ğŸ“¡ [ç²¾æº–è¡é‹’] åŸ·è¡Œå”è­°æ ¡é©—ä¸­...")
    try:
        # ä¸€è¡Œè¨»è§£ï¼šç™¼é€å¸¶æœ‰é©—è­‰æ¨™é ­çš„ POST è«‹æ±‚ã€‚
        resp = requests.post(target_endpoint, headers=secure_headers, timeout=30)
        
        # ä¸€è¡Œè¨»è§£ï¼šè¼¸å‡ºç‹€æ…‹ç¢¼ã€‚
        print(f"ğŸ“¡ [å›å ±] ç‹€æ…‹ç¢¼ï¼š{resp.status_code}")
        
        # ä¸€è¡Œè¨»è§£ï¼šé™åˆ¶å›æ‡‰å…§å®¹è¼¸å‡ºé•·åº¦ï¼Œä¿éšœè³‡å®‰ã€‚
        print(f"ğŸ“¡ [å›æ‡‰æ‘˜è¦]ï¼š{resp.text[:50]}...")
        
        if resp.status_code == 202:
            print(f"ğŸ† [çªç ´] æˆåŠŸï¼ç›®æ¨™ç«¯é»å·²ç¢ºèªé€šè¡Œè­‰ã€‚")
        elif resp.status_code == 404:
            print(f"âš ï¸ [åº§æ¨™åé›¢] 404ï¼è«‹ç¢ºèª URL åŒ…å«æ­£ç¢ºè·¯å¾‘å°¾ç¢¼ã€‚")
        elif resp.status_code == 403:
            print(f"ğŸš« [é©—è­‰å¤±æ•—] 403ï¼æ†‘è­‰å…§å®¹ä¸åŒ¹é…ã€‚")
            
    except Exception:
        # ä¸€è¡Œè¨»è§£ï¼šé®è”½å…·é«”é€£ç·šéŒ¯èª¤ç´°ç¯€ï¼Œé˜²æ­¢æ—¥èªŒæŒ‡ç´‹å¤–æ´©ã€‚
        print("âŒ [éŒ¯èª¤] é€šè¨Šéˆè·¯å¯¦é«”æ–·è£‚ã€‚")

if __name__ == "__main__":
    run_precision_verification()
# -----(å®šä½ç·š)ä»¥ä¸Šä¿®æ”¹å®Œç•¢-----