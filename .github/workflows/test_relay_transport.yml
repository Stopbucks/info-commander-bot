##########################################################################
# ğŸ§ª S-Plan ç‰¹ç¨®ç‰©æµæ¼”ç¿’ (Chunked Relay Transport)
# ä»»å‹™ï¼šæ¸¬è©¦ WebScraping.ai åˆ†æ®µæ¬é‹ 1MB ç‰‡æ®µèˆ‡ FFmpeg ç¸«åˆæŠ€è¡“
###########################################################################
name: ğŸ§ª S-Plan Relay Test

on:
  workflow_dispatch:

jobs:
  transport_test:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    env:
      WEBSCRAP_API_KEY: ${{ secrets.WEBSCRAP_API_KEY }}
      R2_ACCESS_KEY_ID: ${{ secrets.R2_ACCESS_KEY_ID }}
      R2_SECRET_ACCESS_KEY: ${{ secrets.R2_SECRET_ACCESS_KEY }}
      R2_ACCOUNT_ID: ${{ secrets.R2_ACCOUNT_ID }}
      R2_BUCKET_NAME: ${{ secrets.R2_BUCKET_NAME }}
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      PYTHONUNBUFFERED: 1

    steps:
    - name: ğŸ“¦ æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: ğŸ è¨­å®š Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'

    - name: âš™ï¸ å®‰è£å¿…è¦ä¾è³´èˆ‡ FFmpeg
      # ä¸€è¡Œè¨»è§£ï¼šè£œé½Š google-generativeai èˆ‡ groqï¼Œç¢ºä¿ AIAgent èƒ½æ­£å¸¸å•Ÿå‹•ã€‚
      run: |
        sudo apt-get update && sudo apt-get install -y ffmpeg
        python -m pip install --upgrade pip
        pip install requests boto3 supabase python-dotenv google-generativeai groq beautifulsoup4

    - name: ğŸ¯ åŸ·è¡Œåˆ†æ®µæ¬é‹æ¸¬è©¦ (å« AI å ±æˆ°)
      run: python src/test_chunked_transport.py