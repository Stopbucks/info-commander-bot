##########################################################################
# ğŸƒ S-Plan 3.0 å…¨éˆæ¢æ¥åŠ›æ¼”ç¿’ (Officer + Transport åŠ å›ºç‰ˆ)
##########################################################################
# ç›®çš„ï¼šå¯¦ç¾ã€Œè§£ç¢¼ -> é‹è¼¸ã€è‡ªå‹•æ¥åŠ›ï¼Œä¸¦å®¹ç´æ·±åº¦æŠ–å‹•æ‰€éœ€çš„é•·é‹è¡Œæ™‚é–“ã€‚
##########################################################################

name: ğŸƒ S-Plan 2.0 Relay Race Test

on:
  workflow_dispatch: # æ”¯æ´æ‰‹å‹•è§¸ç™¼

jobs:
  relay_mission:
    runs-on: ubuntu-latest
    # ä¸€è¡Œè¨»è§£ï¼šå°‡ Job ç¸½æ™‚é™è¨­ç‚º 30 åˆ†é˜ï¼Œä»¥å®¹ç´ Python ç¨‹å¼ç¢¼ä¸­çš„æ·±åº¦ Jitter å»¶é²ã€‚
    timeout-minutes: 30 
    
    steps:
    - name: ğŸ“¦ æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: ğŸ è¨­å®š Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'

    - name: âš™ï¸ å®‰è£å¿…è¦ä¾è³´
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 supabase python-dotenv boto3 google-generativeai groq
        
    # ---------------------------------------------------------
    # ç¬¬ä¸€æ£’ï¼šè§£ç¢¼å®˜ (Officer) - é ˜ç¥¨è¡Œå‹•
    # ---------------------------------------------------------
    - name: ğŸ¯ åŸ·è¡Œè§£ç¢¼ä»»å‹™ (Officer)
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        SCRAP_API_KEY: ${{ secrets.SCRAP_API_KEY }}
        PYTHONUNBUFFERED: 1
      run: |
        echo "ğŸ“¡ [ç¬¬ä¸€æ£’] å‘¼å«è§£ç¢¼å®˜åŸ·è¡Œä»»å‹™..."
        python src/pod_scra_officer.py

    - name: ğŸ•’ æˆ°è¡“å†·å» (ç­‰å¾… 10 ç§’)
      run: sleep 10


#--- å®šä½ç·šï¼šæ¥çºŒåœ¨ã€Œæˆ°è¡“å†·å»ã€æ­¥é©Ÿä¹‹å¾Œ ---#

    - name: ğŸšš åŸ·è¡Œé‹è¼¸èˆ‡ AI æ‘˜è¦ä»»å‹™
      timeout-minutes: 20
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        R2_ACCESS_KEY_ID: ${{ secrets.R2_ACCESS_KEY_ID }}
        R2_SECRET_ACCESS_KEY: ${{ secrets.R2_SECRET_ACCESS_KEY }}
        R2_ACCOUNT_ID: ${{ secrets.R2_ACCOUNT_ID }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        PYTHONUNBUFFERED: 1
      run: |
        echo "ğŸšš [å•Ÿå‹•] é‹è¼¸å…µåŸ·è¡Œå…¥åº«ä¸¦å‘¼å«æ™ºå›Šåœ˜..."
        python src/pod_scra_transport.py

#-----(å®šä½ç·š)ä»¥ä¸Šä¿®æ”¹-----