##########################################################################
# ğŸƒ S-Plan 3.0 å…¨éˆæ¢æ¥åŠ›æ¼”ç¿’ (Officer + Transport)
##########################################################################
# ç›®çš„ï¼šå¯¦ç¾ã€Œè§£ç¢¼ -> é‹è¼¸ã€è‡ªå‹•æ¥åŠ›ï¼Œé©—è­‰ Podbay é–€ç¥¨æ™‚æ•ˆèˆ‡ç›´é€šè»Šå¯è¡Œæ€§ã€‚
# æµç¨‹ï¼š1. è§£ç¢¼å®˜ç²å–é€£çµ -> 2. æˆ°è¡“å†·å» -> 3. é‹è¼¸å…µåŸ·è¡Œå»¶æ™‚ä¸‹è¼‰æ¸¬è©¦ã€‚
##########################################################################

name: ğŸƒ S-Plan 2.0 Relay Race Test

on:
  workflow_dispatch: # æ”¯æ´æ‰‹å‹•è§¸ç™¼

jobs:
  relay_mission:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ“¦ æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: ğŸ è¨­å®š Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'

    - name: âš™ï¸ å®‰è£å¿…è¦ä¾è³´ (å«æœªä¾†é‹è¼¸æ‰€éœ€çš„ boto3)
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 supabase python-dotenv boto3

    # ---------------------------------------------------------
    # ç¬¬ä¸€æ£’ï¼šè§£ç¢¼å®˜ (Officer) - é ˜ç¥¨è¡Œå‹• [cite: 2026-02-16]
    # ---------------------------------------------------------
    - name: ğŸ¯ åŸ·è¡Œè§£ç¢¼ä»»å‹™ (Officer)
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        SCRAP_API_KEY: ${{ secrets.SCRAP_API_KEY }}
        PYTHONUNBUFFERED: 1
      run: |
        echo "ğŸ“¡ [ç¬¬ä¸€æ£’] å‘¼å«è§£ç¢¼å®˜åŸ·è¡Œä»»å‹™..."
        python src/pod_scra_officer.py

    - name: ğŸ•’ æˆ°è¡“å†·å» (ç­‰å¾… 10 ç§’ç¢ºä¿é›²ç«¯åœ°åŸºåŒæ­¥)
      run: sleep 10

    # ---------------------------------------------------------
    # ç¬¬äºŒæ£’ï¼šé‹è¼¸å…µ (Transport) - ç›´é€šè»Šä¸‹è¼‰æ¸¬è©¦ [cite: 2026-02-16]
    # ---------------------------------------------------------
    - name: ğŸšš åŸ·è¡Œé‹è¼¸æ¸¬è©¦ (Transport v0.1)
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        # é ç•™ R2 é‡‘é‘°ï¼Œç¢ºä¿ç’°å¢ƒè®Šæ•¸å°é½Š
        R2_ACCESS_KEY_ID: ${{ secrets.R2_ACCESS_KEY_ID }}
        R2_SECRET_ACCESS_KEY: ${{ secrets.R2_SECRET_ACCESS_KEY }}
        R2_ACCOUNT_ID: ${{ secrets.R2_ACCOUNT_ID }}
        PYTHONUNBUFFERED: 1
      run: |
        echo "ğŸšš [ç¬¬äºŒæ£’] å‘¼å«é‹è¼¸å…µé©—è­‰é–€ç¥¨æ™‚æ•ˆ..."
        python src/pod_scra_transport.py