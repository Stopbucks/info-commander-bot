##########################################################################
# ğŸƒ S-Plan 4.0 å…¨éˆæ¢æ¥åŠ› - æˆ°ç•¥è³‡æºè‡ªå‹•é‡è¨­ç‰ˆ
##########################################################################

name: ğŸƒ S-Plan podcast

on:
  schedule:
    # æˆ°è¡“æ’ç¨‹ä¸€ï¼šé€±ä¸€è‡³é€±äº”å‡Œæ™¨ 03:00 (UTC 19:00) åŸ·è¡Œä¾‹è¡Œä»»å‹™
    - cron: '0 19 * * 1-5'
    # æˆ°è¡“æ’ç¨‹äºŒï¼šæ¯æœˆ 1 æ—¥å‡Œæ™¨ 03:00 (UTC 19:00) å¼·åˆ¶å–šé†’ï¼Œç¢ºä¿é»æ•¸é‡ç½® (ä¸è«–æ˜¯å¦ç‚ºé€±æœ«)
    - cron: '0 19 1 * *'
  
  workflow_dispatch:
    inputs:
      force_mode:
        description: 'ğŸš€ æˆ°ç•¥æ¨¡å¼åˆ‡æ› (AUTO / MODE_1 / MODE_2)'
        required: true
        default: 'AUTO'
        type: choice
        options:
        - AUTO
        - MODE_1
        - MODE_2

jobs:
  relay_mission:
    runs-on: ubuntu-latest
    # ä¸€è¡Œè¨»è§£ï¼šå°‡è¶…æ™‚å»¶é•·è‡³ 180 åˆ†é˜ï¼Œç¢ºä¿åŒ…å« Jitter èˆ‡ä»»å‹™é–“éš”çš„é«˜å£“ç’°å¢ƒèƒ½å®‰å…¨å®Œæˆã€‚
    timeout-minutes: 180 
    
    steps:
    - name: ğŸ“¦ æª¢å‡ºç¨‹å¼ç¢¼
      uses: actions/checkout@v4

    - name: ğŸ è¨­å®š Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'

    - name: âš™ï¸ å®‰è£å¿…è¦ä¾è³´
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 supabase python-dotenv boto3 google-generativeai groq
        
    - name: ğŸ¯ åŸ·è¡Œè§£ç¢¼ä»»å‹™ (Officer)
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        SCRAP_API_KEY: ${{ secrets.SCRAP_API_KEY }}
        ZENROWS_API_KEY: ${{ secrets.ZENROWS_API_KEY }}
        # ä¸€è¡Œè¨»è§£ï¼šè™•ç†æ‰‹å‹•è§¸ç™¼(inputs)èˆ‡è‡ªå‹•æ’ç¨‹(schedule)çš„è®Šæ•¸å°ä½ã€‚
        STRATEGY_MODE: ${{ github.event.inputs.force_mode || 'AUTO' }}
        PYTHONUNBUFFERED: 1
      run: |
        echo "ğŸ“¡ [å•Ÿå‹•] è§£ç¢¼å®˜åŸ·è¡Œä»»å‹™ï¼Œç•¶å‰æˆ°ç•¥æ¨¡å¼: $STRATEGY_MODE"
        python src/pod_scra_officer.py

#--- (å®šä½ç·š) ä»¥ä¸‹ç‚ºé‹è¼¸å…µæ­¥é©Ÿï¼ŒåŒæ¨£éœ€ç¢ºä¿è¶…æ™‚è¨­å®šè¶³å¤  ---#
    - name: ğŸšš åŸ·è¡Œé‹è¼¸èˆ‡ AI æ‘˜è¦ä»»å‹™
      timeout-minutes: 60
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        # ... (å…¶é¤˜ Secrets ä¿æŒä¸è®Š)
      run: |
        python src/pod_scra_transport.py